<!DOCTYPE html>
<html>
<head>
<title>Page Title</title>
</head>
<body>
    <h2>Create</h2>
    <form>
        <input name="user_id" placeholder="user_id">
        <input name="lat" placeholder="lat">
        <input name="lon" placeholder="lon">
        <input name="image" placeholder="image">
        <input name="keywords" placeholder="keywords">
        <textarea name="description" placeholder="description"></textarea>
        <button data-action="create_item">Create Item</button>
    </form>
    <!-- Hints
        1.) Prevent default onSubmit behaviour
        2.) Bind all inputs to data model
        3.) Bind POST action to button
    -->
    
    <h2>Items</h2>
    <ul>
        <li><!-- Somehow templated for each item -->
            <img src="item.image">
            <span data-field="id">??? item.id ???</span>
            <span data-field="lat">??? item.lat ???</span>
            ...
            <button data-action="delete" someKindOfOnClickAction="deleteItem(item.id)">Delete</button>
        </li>
    </ul>
    <script type="module">
        import { createApp } from 'vue'
    
    const DEFAULT_API = '/api/v1';  // default to current http(s)://currentHost:currentPort/api/v1'
	const urlParams = new URLSearchParams(window.location.search);
	const urlAPI = (urlParams.get('api') || DEFAULT_API).replace(/\/$/, '');  // Get api url (and remove trailing slash if present)

    
        const RootComponent = {
          data() {
            return {
                attendee: {
                    id: '',
                    name: '',
                    notes: '',
                },
                attendees: [],
            }
          },
          created() {
            this.clearInput()
            this.updateAttendees()
          },
          components: {
          },
          methods: {
            updateAttendees() {
                fetch(`${urlAPI}/attendees`, {
                })
                    .then(response => response.json())
                    .then(json => {this.attendees = json})
                .catch(err => console.error(err))
            },
            clearInput() {
                this.attendee = {...this.attendee, ...{
                    id: Math.random(),
                    name: undefined,
                    notes: undefined,
                }}
            },
            addAttendee() {
                fetch(`${urlAPI}/attendee`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(this.attendee),
                })
                    .then(response => response.json())
                    .then(()=>this.clearInput())
                    .then(()=>this.updateAttendees())
                .catch(err => console.error(err));
            },
            deleteAttendee(id) {
                fetch(`${urlAPI}/attendee/${id}`, {
                    method: 'DELETE',
                })
                    .then(()=>this.updateAttendees())
                .catch(err => console.error(err));
            }
          },
        }
        const app = createApp(RootComponent)
        const vm = app.mount('#app')
    </script>
</body>
</html>